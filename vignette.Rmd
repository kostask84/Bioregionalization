---
title: "Vignette"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(Bioregionalization)
library(dplyr)

```

`virtual_sp` is a dataset simulated that comes with the package.
This dataset relies on the response curve of virtual species to a virtual
raster.
The virtual raster contains 10000 cells and was simulated using `gstat`
R package.
[See here for details.](http://santiago.begueria.es/2010/10/generating-spatially-correlated-random-fields-with-r/)

Based on this layer, the `virtualspecies` R package (Leroy et al. 2015)
was used to simulate the response curve of 100 virtual species.
A Gaussian curve was used.
The mean and standard deviation of the response function was varying among
species, such as some of them are more or less generalists/specialists.

For every species in every cell, we could derive a suitability index.
Species with suitability index inferior to 0.15 were arbitrarily set absent.

```{r dataset}
# Import virtual dataset
data("virtual_sp")
```

The first step is to convert the data.frame into a contingency table.

```{r contingency_matrix}
sp_mat <- contingency(sp_df, "sp", "site", "pa", binary = TRUE)
```

We then need to project the network.

```{r projection}
sp_proj <- project_network(sp_mat, similarity = "simpson")
sp_proj <- sp_proj[, c("id1", "id2", "simpson")]

# write.table(sp_proj[, c("id1", "id2", "simpson")], "OSLOM2/vignette.txt",
#             row.names = FALSE)

```

Running OSLOM (under Linux distribution).

Here:
./oslom_undir -r 10 -seed 1000 -t 0.5 -cp 0.5 -f vignette.txt -w

Converting the OSLOM .tp file into a list.

```{r conversion_OSLOM}
res <- readLines("OSLOM2/vignette.txt_oslo_files/tp")
oslom_vignette <- oslom_output(res, sp_mat)
length(unique(oslom_vignette$bioregion))
```

Function to compute zscores.

Example with CA analysis and k-means clustering.

```{r CA_cluster}
CA_res <- CA_cluster(sp_mat)
```

Projection on a map.





